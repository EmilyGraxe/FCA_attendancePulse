<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <title>Attendance Report - <%= month %>/<%= year %>
        </title>
        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <script src="/js/xlsx.full.min.js"></script>
        <link rel="stylesheet" href="/css/styles.css">
        <style>
            body {
                font-family: Arial, sans-serif;
                background: #f4fdf7;
                margin: 0;
                padding: 0;
            }

            .header {
                background: var(--primary, #007bff);
                color: white;
                padding: 20px;
                text-align: center;
                font-size: 1.5em;
                font-weight: bold;
            }

            .container {
                width: 95%;
                max-width: 100%;
                margin: 20px auto;
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                overflow-x: auto;
                /* enable horizontal scrolling */
            }

            form {
                margin-bottom: 20px;
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                align-items: center;
            }

            select,
            button {
                padding: 6px 12px;
                font-size: 1em;
            }

            table {
                border-collapse: collapse;
                width: 100%;
                table-layout: fixed;
                /* evenly distributed columns */
                text-align: center;
            }

            th,
            td {
                width: 40px;
                border: 1px solid #ddd;
                padding: 6px;
                font-size: 0.9em;
                word-wrap: break-word;
            }

            th {
                background: var(--primary, #007bff);
                color: white;
                position: sticky;
                top: 0;
                z-index: 1;
            }

            th.student-col {
                width: 200px;
                /* make first column wider */
            }

            th.total-col,
            td.total-col {
                width: 80px;
                font-weight: bold;
            }

            td.weekend {
                background: #f0f8ff;
                /* lighter weekend color */
            }

            td.P {
                background: #c8e6c9;
                font-weight: bold;
            }

            td.O {
                background: #ffcdd2;
                font-weight: bold;
            }

            td.empty {
                background: white;
            }

            @media(max-width: 768px) {

                table,
                th,
                td {
                    font-size: 0.7em;
                }
            }

            /* Draggable circular button */
            #backHomeBtn {
                position: fixed;
                bottom: 50px;
                right: 50px;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background: linear-gradient(270deg, #1e7f4f, #30a14e, #6f42c1, #d73a49);
                background-size: 800% 800%;
                color: white;
                font-size: 2em;
                font-weight: bold;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
                cursor: grab;
                z-index: 1000;
                user-select: none;
                animation: gradientBG 6s ease infinite, pulse 1.5s ease-in-out infinite;
                transition: transform 0.2s;
            }

            /* Hover effect */
            #backHomeBtn:hover {
                transform: scale(1.15);
            }

            /* Gradient animation */
            @keyframes gradientBG {
                0% {
                    background-position: 0% 50%;
                }

                50% {
                    background-position: 100% 50%;
                }

                100% {
                    background-position: 0% 50%;
                }
            }

            /* Pulse animation */
            @keyframes pulse {

                0%,
                100% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.1);
                }
            }
        </style>

    </head>

    <body>


        <!-- Page Content -->



        <div class="container">

            <div class="row">
                <div class="col-md-6 bg-light p-3">
                    <form method="GET" action="/api/report/attendance">
                        <label>Month:
                            <select name="month">
                                <% for(let m=1;m<=12;m++){ %>
                                    <option value="<%= m %>" <%=m===month ? "selected" : "" %>><%= m %>
                                    </option>
                                    <% } %>
                            </select>
                        </label>

                        <label>Year:
                            <select name="year">
                                <% const currentYear=new Date().getFullYear(); %>
                                    <% for(let y=currentYear-5;y<=currentYear+1;y++){ %>
                                        <option value="<%= y %>" <%=y===year ? "selected" : "" %>><%= y %>
                                        </option>
                                        <% } %>
                            </select>
                        </label>

                        <button type="submit" style="width: 100px;">Filter</button>
                    </form>
                </div>

                <div class="col-md-6 bg-light  p-3">

                    <button id="exportExcel"
                        style="width: 200px;height: 40px;margin-left: 360px;margin-top: 30px" data-month="<%= month %>" 
    data-year="<%= year %>">Export to
                        Excel</button>
                </div>
            </div>
            <br>
            <table>
                <thead>
                    <tr>
                        <th class="student-col">Student</th>
                        <% days.forEach(day=> {
                            const dateObj = new Date(year, month-1, day);
                            const dayOfWeek = dateObj.getDay();
                            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

                            // Short day names
                            const dayNames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
                            %>
                            <th class="<%= isWeekend ? 'weekend' : '' %>">
                                <%= dayNames[dayOfWeek] %> <br>
                                    <%= day %>
                            </th>
                            <% }); %>
                                <th class="total-col">TotalDays</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (students.length===0) { %>
                        <tr>
                            <td colspan="<%= days.length + 2 %>">No students recorded for this month</td>
                        </tr>
                        <% } else { %>
                            <% students.forEach(student=> {
                                let totalP = 0;
                                %>
                                <tr>
                                    <td>
                                        <%= student.name %>
                                    </td>
                                    <% days.forEach(day=> {
                                        const status = attendanceMap[student.id] ?
                                        attendanceMap[student.id][day] || ''
                                        : '';
                                        if(status === 'P') totalP++;
                                        %>
                                        <td class="<%= status ? status : 'empty' %>">
                                            <%= status %>
                                        </td>
                                        <% }); %>
                                            <td class="total-col">
                                                <%= totalP %>
                                            </td>
                                </tr>
                                <% }); %>
                                    <% } %>
                </tbody>
            </table>
        </div>
        <div id="backHomeBtn" title="Back to Home">&#8592;</div>

    </body>
    <script src="/js/attendance.js"></script>


</html>